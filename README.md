# Сервис для просмотра истории операций

Микросервис, предоставляющий API для просмотра пользовательских транзакций с возможностью фильтрации и пагинации.

---

## Техническое задание

Нужно написать микросервис, который предоставляет API для просмотра транзакций в порядке даты совершения.

Сценарий клиента на UI (только для понимания задания, сам UI реализовывать не нужно):
1. Считается, что на экран пользователя помещается не более **20 транзакций**.
2. Чтобы просмотреть следующие 20 транзакций, пользователь должен проскроллить до конца предыдущих 20.
3. Поскольку у пользователя может быть **огромное количество операций**, требуется реализовать механизм **пагинации** — т.е. возвращать только необходимый пользователю диапазон транзакций.

### Источники данных
Микросервис имеет доступ к двум источникам операций:
- `incomes.csv` — входящие транзакции
- `outcomes.csv` — исходящие транзакции

### Ограничения:
- Считается, что **файлы не влезают целиком в оперативную память**
- Чтение файлов — **дорогая по времени операция**

### Фильтрация
По умолчанию пользователь получает транзакции по **всем счетам за весь период**.

Однако, пользователь может задать дополнительные фильтры:
- По **датам** совершения операций
- По **одному конкретному счёту**

Микросервис принимает **HTTP-запросы** и возвращает данные в формате **JSON**.

---

## Как запустить

1. Убедитесь, что установлен [Docker](https://www.docker.com/) и [Docker Compose](https://docs.docker.com/compose/).
2. Запустите PostgreSQL базу данных:

```bash
docker compose up -d postgres
```

3. Запустите само приложение (например, через IDE).
4. При **первом запуске** происходит **инициализация БД** — данные из CSV-файлов считываются и сохраняются в базу. Это может занять **несколько минут**.

> Это было сделано, поскольку файлы с транзакциями не помещаются целиком в оперативную память.  
> Для эффективной фильтрации и сортировки данных реализовано хранение транзакций в БД, с индексом по дате транзакции.

---

##  Используемый стек технологий

- **Java 17**
- **Spring Boot**
- **Spring Data JPA**
- **PostgreSQL**
- **Docker Compose**
- **JUnit 5** — модульное тестирование
- **Mockito** — мокирование зависимостей (слоя репозитория)
- **Lombok**

---

## Архитектура и особенности реализации

- Проект построен по шаблону **MVC (Model-View-Controller)** для обеспечения **модульности**.
- Для повышения производительности реализована **предзагрузка данных** из файлов в БД с созданием **индекса по дате**.
- Поддерживается **пагинация**: можно запрашивать диапазон транзакций через параметры `from` и `to`.

---

## Тестирование

Реализованы модульные тесты, покрывающие:
- Базовые сценарии (поиск без фильтров, с фильтрами, пагинация)
- Пограничные случаи
- Использована библиотека **Mockito** для мокирования взаимодействия с базой данных
- Использован **JUnit 5** для написания тестов

---

## Примеры запросов

```http
GET api/search?customerId=1
```

```http
GET api/search?from=1&to=2&startTime=2024-01-01T00:00:00&endTime=2025-01-01T00:00:00&accountId=9895153
&customerId=1
```

---

## Проверка доступности

```http
GET api/ping
```